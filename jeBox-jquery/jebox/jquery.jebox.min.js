/**
 @Name : jeBox v1.3 弹层组件
 @Author: chen guojun
 @Date: 2017-03-20
 @QQ群：516754269
 @官网：http://www.jemui.com/jebox/ 或 https://github.com/singod/jeBox
 */
!function(a,b){"function"==typeof define&&define.amd?define(["jquery"],b):"object"==typeof exports?module.exports=b():a.jeBox=b(window.jQuery||$)}(this,function(a){function g(c){var d={cell:"",title:"提示信息",content:"暂无内容！",boxStyle:{},closeBtn:!0,closefun:null,maxBtn:!1,boxSize:["auto","auto"],padding:"5px",offset:["auto","auto"],type:1,icon:0,button:[],btnAlign:"right",time:0,masklock:!0,maskClose:!0,maskColor:["#000",.5],isDrag:!0,fixed:!0,zIndex:9999,scrollbar:!1,shadow:!0,success:null,endfun:null},e=this;e.config=a.extend(!0,d,c||{}),e.index=""==e.config.cell||void 0==e.config.cell?++b.index:e.config.cell,e.initView()}function i(a,b,c,d,e){b.length>0&&b.parent()?b.after(a):c.length>0&&c.parent()?c.before(a):d.length>0&&d.append(a),a.css("display",e),this.backSitu=null}var f,h,b={},c={},d=/\px|em/g,e=-[1]?9:parseInt(navigator.appVersion.split(";")[1].replace(/MSIE|[ ]/g,""));return b.index=Math.floor(9e3*Math.random()),c.isBool=function(a){return void 0==a||1==a?!0:!1},c.endfun={},f=["jeBox",".jeBox-wrap",".jeBox-header",".jeBox-content",".jeBox-footer",".jeBox-close",".jeBox-maxbtn"],h=g.prototype,h.initView=function(){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,b=this,d=b.config;c.scrollbar=d.scrollbar,""!=d.cell&&a("#"+f[0]+b.index).size()>0||(g=d.button,h=g.length,i=function(){var b=0!=h?function(){var b=[];return a.each(g,function(a,c){b.push('<button type="button" class="jeBox-btn'+a+'" jebtn="'+a+'" '+(1==c.disabled?"disabled":"")+">"+c.name+"</button>")}),b.join("")}():"";return'<div class="jeBox-footer">'+b+"</div>"}(),j=d.padding,k=d.skinCell||"jeBox-anim",l='<span class="jeBox-headbtn"><a href="javascript:;" class="jeBox-maxbtn" title="最大化"></a><a href="javascript:;" class="jeBox-close" title="&#20851;&#38381;"></a></span><div class="jeBox-header"></div><div class="jeBox-content" style="padding:'+(""!=j?j:0)+';"></div>'+i,m=function(b){var c=0;return b.each(function(){c=Math.max(c,a(this).css("z-index"))}),c},n=d.zIndex,o=a(f[1]).size()>0?m(a(f[1]))+5:n+5,p=a(f[1]).size()>0?m(a(f[1]))+2:n,q=a("<div/>",{id:f[0]+b.index,"class":f[1].replace(/\./g,"")}),a("body").append(q.append(l)),q.attr("jeitem",b.index),q.css({position:d.fixed?"fixed":"absolute","z-index":o}),parseInt(e)<9?q.addClass("jeBox-ies"):q.addClass(k),d.masklock&&(r=a("<div/>",{id:"jemask"+b.index,"class":"jeBox-mask"}),s=d.maskColor,a("body").append(r),r.css({left:0,top:0,"background-color":s[0],"z-index":p,opacity:s[1],filter:"alpha(opacity="+100*s[1]+")"})),t=a("#"+f[0]+b.index),u=0==d.title?"":d.title||config.title,v="object"==typeof u,w=u?v?u[0]:u:"",t.find(f[2]).html(w).css({display:""!=w?"":"none",height:""!=w?"":"0px"}).css(v?u[1]:{}),t.find(f[4]).css({display:0!=h?"block":"none","text-align":d.btnAlign}),t.find(f[5]).css("display",d.closeBtn?"":"none"),t.find(f[6]).css("display",d.maxBtn?"":"none"),!c.scrollbar&&a("body").css("overflow","hidden"),b.setContent(d),b.setSize(d,t),b.setPosition(d,t),b.btnCallback(d,t),d.isDrag&&""!=w&&(x=t,y=t.find(f[2]),b.dragLayer(x,y,.4,d.shadow)),setTimeout(function(){d.success&&d.success(t,b.index)},5))},h.setContent=function(b){var l,d=this,e=a("#"+f[0]+d.index).find(f[3]),g=b.content,h=b.type,i=b.icon,j="object"==typeof g,k='<div class="jeBox-iconbox jeicon'+i+'">'+g+"</div>";switch(h){case 1:"string"==typeof g?e.html(0!==i?k:g):g[0]&&1===g[0].nodeType&&(a("#"+f[0]+d.index).attr("jenode",g.selector.toString()),c.Dispy=g.css("display"),c.Prev=g.prev(),c.Next=g.next(),c.Parent=g.parent(),"none"==g.css("display")&&g.css("display","block"),e.append(g));break;case 2:l=j?g:[g||"http://www.jayui.com/","auto"],e.html('<iframe scrolling="'+(l[1]||"auto")+'" allowtransparency="true" id="jeboxiframe'+d.index+'" name="'+d.index+'" onload="this.className=\'\';" frameborder="0" width="100%" height="100%" src="'+l[0]+'"></iframe>');break;case 3:e.html('<div class="jeBox-loadbox jeload'+i+'">'+g+"</div>")}return d},h.setSize=function(b,e){var h,i,j,k,l,m,y,z,A,B,g=this,n=e.find(f[3]),o=b.boxSize,p=function(a){return parseInt(n.css(a).replace(d,""))},q=a(window).width(),r=a(window).height(),s=c.conhead=e.find(f[2]).height(),t=c.confoot=e.find(f[4]).height(),u=p("padding-top")+p("padding-bottom"),v=p("padding-left")+p("padding-right"),w=p("margin-top")+p("margin-bottom"),x=p("margin-left")+p("margin-right");return a.isArray(o)&&(h=o[0],i=o[1],y=/^\d+%$/.test(h.toString())?parseInt(q*(h.toString().replace("%","")/100)):parseInt(h.toString().replace(d,"")),z=y>=q?q:y,A=/^\d+%$/.test(i.toString())?parseInt(r*(i.toString().replace("%","")/100)):parseInt(i.toString().replace(d,"")),B=A>=r?r:A,"number"===a.type(h)?(j=y+v+x,l=y):"auto"==h?(j=e.outerWidth(!0)+v+x,l=e.outerWidth(!0)):(j=z,l=z-v-x),"number"===a.type(i)?(k=A+u+w,m=A-s-t):"auto"==i?(k=e.outerHeight(!0),m=e.outerHeight(!0)-u-w-s-t):(k=B,m=B-u-w-s-t)),b.maxBtn&&e.attr("area",[j,k,l,m]),e.css({width:j,height:k}).css(b.boxStyle),e.find(f[3]).css({width:l,height:m}),g},h.setPosition=function(b,c){var e=this,i=b.offset,j=a.isArray(i),k=c.width(),l=c.height(),f=i[0],m=i[1],n=a(window).width(),o=a(window).height(),g=j&&/^\@/.test(f)?f.replace(/\@/g,""):"auto"==f?(o-l)/2:/^\d+%$/.test(f)?f:f.replace(d,""),h=j&&/^\@/.test(m)?m.replace(/\@/g,""):"auto"==m?(n-k)/2:/^\d+%$/.test(m)?m:m.replace(d,""),p=j&&(/^\@/.test(f)||/^\@/.test(m))?{right:g,bottom:h}:{top:g,left:h};return c.css(p),b.maxBtn&&c.attr("offset",[g,h]),e},h.btnCallback=function(d,e){function l(){var a=d.closefun&&d.closefun(g.index);a===!1||b.close(g.index)}var g=this,h=e.find(f[6]),i=d.time,j=d.button,k=d.offset;return 0>=i||setTimeout(function(){b.close(g.index)},1e3*i),d.closeBtn&&e.find(f[5]).on("click",l),d.maxBtn&&h.bind("click",function(){h.hasClass("revert")?(h.removeClass("revert"),b.restore(g.index),a(this).attr("title","最大化")):(h.addClass("revert"),b.full(g.index),a(this).attr("title","还原"))}),j&&e.find(f[4]+" button").on("click",function(){var d,c=parseInt(a(this).attr("jebtn"));0===c&&(j[0]["callback"]?j[0]["callback"](g.index,e):b.close(g.index,e)),j.length>1&&(d=j[c]["callback"]&&j[c]["callback"](g.index,e),d===!1||b.close(g.index))}),d.maskClose&&a("#jemask"+g.index).on("click",function(){b.close(g.index)}),a(window).resize(function(){a.isArray(k)&&(/^\@/.test(k[0])||/^\@/.test(k[1]))&&e.css({top:"",left:""}),g.setPosition(d,e)}),d.endfun&&(c.endfun[g.index]=d.endfun),g},h.dragLayer=function(b,c,e,f){var i,g=this,h=!-[1];return c=c||b,i=tmpY=0,g.isMoveable=!1,c.css("cursor","move"),f?(g.isShadow=f?1==f||0==f?f:!1:!1,g.isShadow&&(g.opacity=e)):(g.opacity=100,g.isShadow=!1),c.on("mousedown",function(c){var e,f,j,k;return c=c||window.event,e=a("<div/>",{id:"jeBox-moves","class":"jeBox-moves"}),f=b.css("left"),j=b.css("top"),k=a("<div/>",{"class":"movescon"}),h&&1!=c.button||h&&0==c.button?!1:(g.isShadow&&(e.css({width:b.outerWidth()-4,height:b.outerHeight()-4,left:f,top:j,"z-index":parseInt(b.css("z-index"))+10}),a("body").append(e.append(k))),g.isMoveable=!0,i=c.pageX-f.replace(d,""),tmpY=c.pageY-j.replace(d,""),c.preventDefault&&(c.preventDefault(),c.stopPropagation()),a(document).on("mousemove",function(c){if(g.isMoveable){window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();var c=c||window.event,d=g.isShadow?e:b,f=c.pageX-i,h=c.pageY-tmpY,j=a(window).width()-b.outerWidth(),k=a(window).height()-b.outerHeight();0>=f&&(f=0),0>=h&&(h=0),f>=j&&(f=j),h>=k&&(h=k),d.css({top:h,left:f})}}).on("mouseup",function(){g.isMoveable&&(g.isMoveable=!1,i=tmpY=0,b.css({right:"",bottom:""}),g.isShadow&&(b.css({top:e.css("top"),left:e.css("left")}),a("#jeBox-moves").remove()),a(window).width()!=b.outerWidth()&&b.attr("offset",[b.css("top").replace(d,""),b.css("left").replace(d,"")]))}),void 0)}),g},b.open=function(a){var b=new g(a||{});return b.index},b.close=function(b){var d=a("#"+f[0]+b),e=a("#jemask"+b),g=d.attr("jenode");d&&(a(g).size()>0&&1===a(g)[0].nodeType&&i(a(g),c.Prev,c.Next,c.Parent,c.Dispy),d&&d.remove(),e&&e.remove(),"hidden"==a("body").css("overflow")&&a("body").css("overflow",""),"function"==typeof c.endfun[b]&&c.endfun[b](),delete c.endfun[b])},b.closeAll=function(){a(f[1]).each(function(a,c){b.close(c.attr("jeitem"))})},b.version="1.3",b.title=function(b,c){a("#"+f[0]+c).find(f[2]).html(b)},b.content=function(b,c){a("#"+f[0]+c).find(f[3]).html(b)},b.msg=function(c,d,e){var f=a.isFunction(d);return f&&(e=d),b.open(a.extend({title:!1,content:c,padding:"10px",skinCell:"jeBox-animMsg",time:3,masklock:!1,closeBtn:!1,end:e},!f&&function(){return d=d||{}}()))},b.alert=function(c,d,e){var f=a.isFunction(d);return f&&(e=d),b.open(a.extend({content:c,button:[{name:"确定",callback:e}]},f?{}:d))},b.loading=function(c,d,e){return b.open(a.extend({title:!1,closeBtn:!1,type:3,skinCell:"jeBox-animLoad",masklock:!1,content:void 0==d?"":d,icon:c||1},e))},b.restore=function(b){var d=a("#"+f[0]+b),e=d.find(f[3]),g=d.attr("area").split(/,/g),h=d.attr("offset").split(/,/g);a("body").css("overflow",0==c.scrollbar?"hidden":""),d.css({width:g[0],height:g[1],top:h[0]+"px",left:h[1]+"px",right:"",bottom:""}),e.css({width:g[2],height:g[3]})},b.full=function(b){var c,d=a("#"+f[0]+b),e=d.find(f[3]);a("body").css("overflow","hidden"),clearTimeout(c),c=setTimeout(function(){d.find(f[6]).addClass("revert");var b="fixed"===d.css("position"),c=d.attr("offset").split(","),g=a(window).width(),h=a(window).height(),i=e.outerWidth(!0)-e.width(),j=e.outerHeight(!0)-e.height(),k=d.find(f[2]).outerHeight(!0),l=d.find(f[4]).outerHeight(!0);d.css({width:g,height:h,top:b?0:c[0],left:b?0:c[1],right:"",bottom:""}),e.css({width:g-i,height:h-j-k-l})},5)},b.getChildFrame=function(b,c){return c=c||a(".jeboxiframe").attr("jeitem"),a("#"+f[0]+c).find("iframe").contents().find(b)},b.getFrameIndex=function(b){return a("#"+f[0]+b).attr("jeitem")},b.iframeUrl=function(b,c){a("#"+f[0]+b).find("iframe").attr("src",c)},b});
